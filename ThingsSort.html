<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Task Priority</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    padding: 20px;
    user-select: none;
  }

  h2 {
    cursor: pointer;
    margin-bottom: 10px;
    font-size: 1.4rem;
  }

  .category {
    margin-bottom: 30px;
  }

  ul {
    list-style: none;
    padding: 0;
    margin-top: 10px;
  }

  li {
    background: #222;
    margin-bottom: 6px;
    padding: 10px;
    border-radius: 8px;
    cursor: grab;
  }

  li:active {
    cursor: grabbing;
  }

  input {
    width: 100%;
    padding: 10px;
    background: #1a1a1a;
    color: #fff;
    border: 1px solid #333;
    border-radius: 8px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="category" id="high">
  <h2>‚≠ê High Priority</h2>
  <input class="newTask" placeholder="Must-do / Time-sensitive">
  <ul class="taskList"></ul>
</div>

<div class="category" id="medium">
  <h2>üåô Medium Priority</h2>
  <input class="newTask" placeholder="Quality / Future Progress">
  <ul class="taskList"></ul>
</div>

<div class="category" id="low">
  <h2>üçÉ Low Priority</h2>
  <input class="newTask" placeholder="Comfort / Mood-based">
  <ul class="taskList"></ul>
</div>

<script>
document.querySelectorAll('.category').forEach(cat => {

  const categoryId = cat.id;
  const title = cat.querySelector('h2');
  const input = cat.querySelector('.newTask');
  const list = cat.querySelector('.taskList');

  // --- Âä†ËΩΩ‰ªªÂä° ---
  loadTasks();

  // ÁÇπÂáª Title ‚Üí Ê∑ªÂä†‰ªªÂä°
  title.addEventListener('click', () => {
    if (input.value.trim() !== "") {
      addTask(input.value.trim());
      input.value = "";
      saveTasks();
    }
  });

  // ËæìÂÖ•Ê°ÜÊåâ Enter
  input.addEventListener('keypress', e => {
    if (e.key === "Enter" && input.value.trim() !== "") {
      addTask(input.value.trim());
      input.value = "";
      saveTasks();
    }
  });

  // ÊãñÊãΩÈÄªËæë
  let draggingEl = null;

  function addTask(text) {
    const li = document.createElement('li');
    li.textContent = text;
    li.draggable = true;

    // ÂèåÂáªÂà†Èô§
    li.addEventListener('dblclick', () => {
      li.remove();
      saveTasks();
    });

    // ÊãñÊãΩÂºÄÂßã
    li.addEventListener('dragstart', () => {
      draggingEl = li;
      li.style.opacity = "0.3";
    });

    // ÊãñÊãΩÁªìÊùü
    li.addEventListener('dragend', () => {
      draggingEl = null;
      li.style.opacity = "1";
      saveTasks();
    });

    list.appendChild(li);
  }

  list.addEventListener('dragover', e => {
    e.preventDefault();
    const afterEl = getDragAfterElement(list, e.clientY);
    if (afterEl == null) {
      list.appendChild(draggingEl);
    } else {
      list.insertBefore(draggingEl, afterEl);
    }
  });

  function getDragAfterElement(list, y) {
    const items = [...list.querySelectorAll('li:not(.dragging)')];
    return items.reduce(
      (closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, 
      { offset: Number.NEGATIVE_INFINITY }
    ).element;
  }

  // --- ‰øùÂ≠òÂà∞ localStorage ---
  function saveTasks() {
    const tasks = [...list.querySelectorAll('li')].map(li => li.textContent);
    localStorage.setItem("tasks_" + categoryId, JSON.stringify(tasks));
  }

  // --- ËØªÂèñ localStorage ---
  function loadTasks() {
    const saved = JSON.parse(localStorage.getItem("tasks_" + categoryId) || "[]");
    saved.forEach(t => addTask(t));
  }

});
</script>

</body>
</html>
